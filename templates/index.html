{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}Главная - Система учета посещений | ОРЛЕУ{% endblock %}

{% block content %}
    {% if user_profile %}
        <!-- Content -->
        <div class="content container-fluid">
            <!-- Page Header -->
            <div class="page-header">
                <div class="row align-items-end">
                    <div class="col-sm mb-2 mb-sm-0">
                        <h1 class="page-header-title">Добро пожаловать, {{ user_profile.full_name }}!</h1>
                        <p class="page-header-text">Управляйте посещаемостью эффективно с помощью системы QR-кодов</p>
                    </div>
                    <div class="col-sm-auto">
                        <div class="d-flex gap-2">
                            {% if user_profile.role == 'participant' %}
                                <a class="btn btn-primary" href="/qr/scan/">
                                    <i class="bi-qr-code-scan me-1"></i> Сканировать QR
                                </a>
                            {% else %}
                                <a class="btn btn-primary" href="{% url 'groups:trainer_groups' %}">
                                    <i class="bi-people-fill me-1"></i> Мои группы
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Page Header -->

            <!-- Stats -->
            {% if user_profile.role != 'participant' %}
                <!-- Stats for Trainers/Admins -->
                <div class="row">
                    <div class="col-sm-6 col-lg-3 mb-3 mb-lg-5">
                        <!-- Card -->
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2">Всего групп</h6>
                                <div class="row align-items-center gx-2">
                                    <div class="col">
                                        <span class="js-counter display-4 text-dark">{{ total_groups|default:0 }}</span>
                                    </div>
                                    <div class="col-auto">
                                        <span class="badge bg-soft-success text-success p-1">
                                            <i class="bi-people-fill"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End Card -->
                    </div>

                    <div class="col-sm-6 col-lg-3 mb-3 mb-lg-5">
                        <!-- Card -->
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2">Всего участников</h6>
                                <div class="row align-items-center gx-2">
                                    <div class="col">
                                        <span class="js-counter display-4 text-dark">{{ total_participants|default:0 }}</span>
                                    </div>
                                    <div class="col-auto">
                                        <span class="badge bg-soft-primary text-primary p-1">
                                            <i class="bi-person-fill"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End Card -->
                    </div>

                    <div class="col-sm-6 col-lg-3 mb-3 mb-lg-5">
                        <!-- Card -->
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2">Посещений сегодня</h6>
                                <div class="row align-items-center gx-2">
                                    <div class="col">
                                        <span class="js-counter display-4 text-dark">{{ today_visits|default:0 }}</span>
                                    </div>
                                    <div class="col-auto">
                                        <span class="badge bg-soft-info text-info p-1">
                                            <i class="bi-calendar-check"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End Card -->
                    </div>

                    <div class="col-sm-6 col-lg-3 mb-3 mb-lg-5">
                        <!-- Card -->
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2">Активных сессий</h6>
                                <div class="row align-items-center gx-2">
                                    <div class="col">
                                        <span class="js-counter display-4 text-dark">{{ active_sessions|default:0 }}</span>
                                    </div>
                                    <div class="col-auto">
                                        <span class="badge bg-soft-warning text-warning p-1">
                                            <i class="bi-clock-fill"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End Card -->
                    </div>
                </div>
            {% else %}
                <!-- Stats for Participants -->
                <div class="row justify-content-center">
                    <div class="col-sm-6 col-lg-4 mb-3 mb-lg-5">
                        <!-- Card -->
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2">Моих посещений сегодня</h6>
                                <div class="row align-items-center gx-2">
                                    <div class="col">
                                        <span class="js-counter display-4 text-dark">{{ my_visits_today|default:0 }}</span>
                                    </div>
                                    <div class="col-auto">
                                        <span class="badge bg-soft-success text-success p-1">
                                            <i class="bi-check-circle-fill"></i>
                                        </span>
                                    </div>
                                </div>
                                <small class="text-muted">Отлично! Продолжайте в том же духе!</small>
                            </div>
                        </div>
                        <!-- End Card -->
                    </div>

                    <div class="col-sm-6 col-lg-4 mb-3 mb-lg-5">
                        <!-- Card -->
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2">Моих групп</h6>
                                <div class="row align-items-center gx-2">
                                    <div class="col">
                                        <span class="js-counter display-4 text-dark">{{ my_groups_count|default:0 }}</span>
                                    </div>
                                    <div class="col-auto">
                                        <span class="badge bg-soft-primary text-primary p-1">
                                            <i class="bi-people-fill"></i>
                                        </span>
                                    </div>
                                </div>
                                <small class="text-muted">Управляйте своим обучением!</small>
                            </div>
                        </div>
                        <!-- End Card -->
                    </div>
                </div>
            {% endif %}
            <!-- End Stats -->

            <!-- Quick Actions -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-header-title">Быстрые действия</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                {% if user_profile.role != 'participant' %}
                                    <div class="col-md-4 mb-3">
                                        <a href="{% url 'groups:trainer_groups' %}" class="btn btn-soft-primary btn-lg w-100">
                                            <i class="bi-people-fill me-2"></i>
                                            Управление группами
                                        </a>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <a href="/attendance/manual/" class="btn btn-soft-info btn-lg w-100">
                                            <i class="bi-pencil-square me-2"></i>
                                            Ручная отметка
                                        </a>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <a href="/qr/generate/" class="btn btn-soft-success btn-lg w-100">
                                            <i class="bi-qr-code me-2"></i>
                                            Создать QR сессию
                                        </a>
                                    </div>
                                {% else %}
                                    <div class="col-md-6 mb-3">
                                        <a href="/qr/scan/" class="btn btn-primary btn-lg w-100">
                                            <i class="bi-qr-code-scan me-2"></i>
                                            Сканировать QR код
                                        </a>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <a href="{% url 'groups:my_groups' %}" class="btn btn-soft-primary btn-lg w-100">
                                            <i class="bi-people me-2"></i>
                                            Мои группы
                                        </a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Quick Actions -->
        </div>
        <!-- End Content -->
    {% else %}
        <!-- Landing Page for Non-authenticated Users -->
        <main id="content" role="main" class="main">
            <!-- Hero -->
            <div class="overflow-hidden gradient-radial-sm-primary">
                <div class="container-lg content-space-t-3 content-space-t-lg-4 content-space-b-2">
                    <div class="w-lg-75 text-center mx-lg-auto">
                        <!-- Heading -->
                        <div class="mb-7">
                            <h1 class="display-2 mb-3">Система учета посещений <span class="text-primary text-highlight-warning">ОРЛЕУ</span></h1>
                            <p class="fs-2">Современная и удобная система контроля посещаемости с использованием QR-кодов</p>
                        </div>
                        <!-- End Heading -->

                        <!-- CTA Buttons -->
                        <div class="d-flex justify-content-center gap-3 mb-7">
                            <a class="btn btn-primary btn-lg" href="{% url 'accounts:login' %}">
                                <i class="bi-box-arrow-in-right me-2"></i>
                                Войти в систему
                            </a>
                            <a class="btn btn-soft-primary btn-lg" href="#features">
                                <i class="bi-info-circle me-2"></i>
                                Узнать больше
                            </a>
                        </div>
                        <!-- End CTA Buttons -->
                    </div>

                    <!-- Hero Image/Illustration -->
                    <div class="text-center">
                        <div class="row justify-content-center">
                            <div class="col-md-8 col-lg-6">
                                <div class="bg-light rounded-3 p-5 shadow-lg">
                                    <i class="bi-qr-code display-1 text-primary mb-3"></i>
                                    <h4 class="text-dark">Быстро • Надежно • Эффективно</h4>
                                    <p class="text-muted mb-0">Сканируйте QR-код для мгновенной отметки посещения</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Hero Image/Illustration -->
                </div>
            </div>
            <!-- End Hero -->

            <!-- Features Section -->
            <div id="features" class="container-lg content-space-2 content-space-lg-3">
                <!-- Heading -->
                <div class="w-lg-75 text-center mx-lg-auto mb-7 mb-md-10">
                    <h2 class="display-4">Возможности <span class="text-primary">системы</span></h2>
                    <p class="lead">Откройте для себя все преимущества современной системы учета посещений</p>
                </div>
                <!-- End Heading -->

                <div class="row">
                    <div class="col-md-6 col-lg-4 mb-4">
                        <!-- Feature Card -->
                        <div class="card card-lg h-100 bg-light border-0 shadow-none text-center">
                            <div class="card-body">
                                <div class="mb-4">
                                    <i class="bi-qr-code-scan display-3 text-primary"></i>
                                </div>
                                <h3 class="card-title">QR-сканирование</h3>
                                <p class="card-text">Мгновенная отметка посещения через сканирование QR-кода с мобильного устройства</p>
                            </div>
                        </div>
                        <!-- End Feature Card -->
                    </div>

                    <div class="col-md-6 col-lg-4 mb-4">
                        <!-- Feature Card -->
                        <div class="card card-lg h-100 bg-light border-0 shadow-none text-center">
                            <div class="card-body">
                                <div class="mb-4">
                                    <i class="bi-people-fill display-3 text-success"></i>
                                </div>
                                <h3 class="card-title">Управление группами</h3>
                                <p class="card-text">Удобное создание и управление учебными группами, добавление участников</p>
                            </div>
                        </div>
                        <!-- End Feature Card -->
                    </div>

                    <div class="col-md-6 col-lg-4 mb-4">
                        <!-- Feature Card -->
                        <div class="card card-lg h-100 bg-light border-0 shadow-none text-center">
                            <div class="card-body">
                                <div class="mb-4">
                                    <i class="bi-graph-up display-3 text-info"></i>
                                </div>
                                <h3 class="card-title">Аналитика</h3>
                                <p class="card-text">Подробная статистика посещаемости с возможностью экспорта отчетов</p>
                            </div>
                        </div>
                        <!-- End Feature Card -->
                    </div>

                    <div class="col-md-6 col-lg-4 mb-4">
                        <!-- Feature Card -->
                        <div class="card card-lg h-100 bg-light border-0 shadow-none text-center">
                            <div class="card-body">
                                <div class="mb-4">
                                    <i class="bi-shield-check display-3 text-warning"></i>
                                </div>
                                <h3 class="card-title">Безопасность</h3>
                                <p class="card-text">Надежная система авторизации и защиты данных участников</p>
                            </div>
                        </div>
                        <!-- End Feature Card -->
                    </div>

                    <div class="col-md-6 col-lg-4 mb-4">
                        <!-- Feature Card -->
                        <div class="card card-lg h-100 bg-light border-0 shadow-none text-center">
                            <div class="card-body">
                                <div class="mb-4">
                                    <i class="bi-clock-fill display-3 text-danger"></i>
                                </div>
                                <h3 class="card-title">Реальное время</h3>
                                <p class="card-text">Мгновенное обновление данных о посещаемости в режиме реального времени</p>
                            </div>
                        </div>
                        <!-- End Feature Card -->
                    </div>

                    <div class="col-md-6 col-lg-4 mb-4">
                        <!-- Feature Card -->
                        <div class="card card-lg h-100 bg-light border-0 shadow-none text-center">
                            <div class="card-body">
                                <div class="mb-4">
                                    <i class="bi-file-earmark-pdf display-3 text-purple"></i>
                                </div>
                                <h3 class="card-title">Экспорт данных</h3>
                                <p class="card-text">Экспорт отчетов в форматах Excel и PDF для дальнейшего анализа</p>
                            </div>
                        </div>
                        <!-- End Feature Card -->
                    </div>
                </div>
            </div>
            <!-- End Features Section -->

            <!-- How it Works -->
            <div class="bg-light">
                <div class="container-lg content-space-2 content-space-lg-3">
                    <!-- Heading -->
                    <div class="w-lg-75 text-center mx-lg-auto mb-7 mb-md-10">
                        <h2 class="display-4">Как это <span class="text-primary">работает</span></h2>
                        <p class="lead">Простой процесс учета посещений в три шага</p>
                    </div>
                    <!-- End Heading -->

                    <div class="row">
                        <div class="col-md-4 mb-5">
                            <!-- Step -->
                            <div class="text-center">
                                <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 4rem; height: 4rem;">
                                    <span class="fs-3 fw-bold">1</span>
                                </div>
                                <h4>Создание сессии</h4>
                                <p class="text-muted">Преподаватель создает QR-сессию для занятия и демонстрирует QR-код группе</p>
                            </div>
                            <!-- End Step -->
                        </div>

                        <div class="col-md-4 mb-5">
                            <!-- Step -->
                            <div class="text-center">
                                <div class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 4rem; height: 4rem;">
                                    <span class="fs-3 fw-bold">2</span>
                                </div>
                                <h4>Сканирование</h4>
                                <p class="text-muted">Участники сканируют QR-код с помощью мобильного устройства или камеры</p>
                            </div>
                            <!-- End Step -->
                        </div>

                        <div class="col-md-4 mb-5">
                            <!-- Step -->
                            <div class="text-center">
                                <div class="bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-4" style="width: 4rem; height: 4rem;">
                                    <span class="fs-3 fw-bold">3</span>
                                </div>
                                <h4>Фиксация</h4>
                                <p class="text-muted">Система автоматически фиксирует посещение и обновляет статистику</p>
                            </div>
                            <!-- End Step -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- End How it Works -->

            <!-- CTA Section -->
            <div class="container-lg content-space-2 content-space-lg-3">
                <div class="text-center">
                    <div class="w-lg-75 mx-lg-auto">
                        <h2 class="display-4 mb-3">Готовы начать?</h2>
                        <p class="fs-2 mb-5">Присоединяйтесь к современной системе учета посещений ОРЛЕУ</p>
                        <a class="btn btn-primary btn-lg" href="{% url 'accounts:login' %}">
                            <i class="bi-box-arrow-in-right me-2"></i>
                            Войти в систему
                        </a>
                    </div>
                </div>
            </div>
            <!-- End CTA Section -->
        </main>
        <!-- End Landing Page -->
    {% endif %}
{% endblock %}
