{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}Главная - Система учета посещений | ОРЛЕУ{% endblock %}

{% block content %}
    {% if user_profile %}
        <!-- Content -->
        <div class="content container-fluid">
            <!-- Page Header -->
            <div class="page-header">
                <div class="row align-items-end">
                    <div class="col-sm mb-2 mb-sm-0">
                        <h1 class="page-header-title">Добро пожаловать, {{ user_profile.full_name }}!</h1>
                        <p class="page-header-text">Управляйте посещаемостью эффективно с помощью системы QR-кодов</p>
                    </div>
                    <div class="col-sm-auto">
                        <div class="d-flex gap-2">
                            {% if user_profile.role == 'participant' %}
                                <a class="btn btn-primary" href="/qr/scan/">
                                    <i class="bi-qr-code-scan me-1"></i> Сканировать QR
                                </a>
                            {% else %}
                                <a class="btn btn-primary" href="{% url 'groups:trainer_groups' %}">
                                    <i class="bi-people-fill me-1"></i> Мои группы
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Page Header -->

            <!-- Stats -->
            <div class="row">
                <div class="col-sm-6 col-lg-3 mb-3 mb-lg-5">
                    <!-- Card -->
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="card-subtitle mb-2">Всего групп</h6>
                            <div class="row align-items-center gx-2">
                                <div class="col">
                                    <span class="js-counter display-4 text-dark">12</span>
                                </div>
                                <div class="col-auto">
                                    <span class="badge bg-soft-success text-success p-1">
                                        <i class="bi-arrow-up"></i> 12.5%
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>

                <div class="col-sm-6 col-lg-3 mb-3 mb-lg-5">
                    <!-- Card -->
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="card-subtitle mb-2">Участников</h6>
                            <div class="row align-items-center gx-2">
                                <div class="col">
                                    <span class="js-counter display-4 text-dark">289</span>
                                </div>
                                <div class="col-auto">
                                    <span class="badge bg-soft-success text-success p-1">
                                        <i class="bi-arrow-up"></i> 5.8%
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>

                <div class="col-sm-6 col-lg-3 mb-3 mb-lg-5">
                    <!-- Card -->
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="card-subtitle mb-2">Посещений сегодня</h6>
                            <div class="row align-items-center gx-2">
                                <div class="col">
                                    <span class="js-counter display-4 text-dark">156</span>
                                </div>
                                <div class="col-auto">
                                    <span class="badge bg-soft-warning text-warning p-1">
                                        <i class="bi-arrow-down"></i> 1.3%
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>

                <div class="col-sm-6 col-lg-3 mb-3 mb-lg-5">
                    <!-- Card -->
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="card-subtitle mb-2">Активных занятий</h6>
                            <div class="row align-items-center gx-2">
                                <div class="col">
                                    <span class="js-counter display-4 text-dark">8</span>
                                </div>
                                <div class="col-auto">
                                    <span class="badge bg-soft-success text-success p-1">
                                        <i class="bi-arrow-up"></i> 20.1%
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>
            </div>
            <!-- End Stats -->

            <!-- Profile Card -->
            <div class="row">
                <div class="col-lg-8 mb-3 mb-lg-5">
                    <!-- Card -->
                    <div class="card h-100">
                        <div class="card-header">
                            <h4 class="card-header-title">
                                <i class="bi-person-badge me-2 text-primary"></i>Информация о пользователе
                            </h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-group list-group-flush list-group-no-gutters">
                                        <li class="list-group-item">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-shrink-0">
                                                    <div class="avatar avatar-xs avatar-soft-primary avatar-circle">
                                                        <span class="avatar-initials">
                                                            <i class="bi-person"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1 ms-3">
                                                    <span class="d-block h5 text-inherit mb-0">{{ user_profile.full_name }}</span>
                                                    <span class="d-block fs-6 text-muted">ФИО</span>
                                                </div>
                                            </div>
                                        </li>
                                        <li class="list-group-item">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-shrink-0">
                                                    <div class="avatar avatar-xs avatar-soft-info avatar-circle">
                                                        <span class="avatar-initials">
                                                            <i class="bi-credit-card"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1 ms-3">
                                                    <span class="d-block h5 text-inherit mb-0">{{ user_profile.iin }}</span>
                                                    <span class="d-block fs-6 text-muted">ИИН</span>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-group list-group-flush list-group-no-gutters">
                                        <li class="list-group-item">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-shrink-0">
                                                    <div class="avatar avatar-xs avatar-soft-success avatar-circle">
                                                        <span class="avatar-initials">
                                                            <i class="bi-envelope"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1 ms-3">
                                                    <span class="d-block h5 text-inherit mb-0">{{ user_profile.email }}</span>
                                                    <span class="d-block fs-6 text-muted">Email</span>
                                                </div>
                                            </div>
                                        </li>
                                        <li class="list-group-item">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-shrink-0">
                                                    <div class="avatar avatar-xs avatar-soft-warning avatar-circle">
                                                        <span class="avatar-initials">
                                                            <i class="bi-shield-check"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="flex-grow-1 ms-3">
                                                    <span class="d-block h5 text-inherit mb-0">{{ user_profile.get_role_display }}</span>
                                                    <span class="d-block fs-6 text-muted">Роль</span>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>

                <div class="col-lg-4 mb-3 mb-lg-5">
                    <!-- Card -->
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <div class="avatar avatar-xl avatar-circle mb-3 mx-auto">
                                <span class="avatar-initials" style="font-size: 2rem;">
                                    {{ user_profile.full_name|slice:":1"|upper }}
                                </span>
                            </div>
                            <h4 class="card-title">{{ user_profile.full_name }}</h4>
                            <p class="card-text">{{ user_profile.get_role_display }}</p>
                            
                            <div class="d-grid gap-2">
                                <a class="btn btn-white btn-sm" href="#">
                                    <i class="bi-person me-1"></i> Просмотр профиля
                                </a>
                                <a class="btn btn-white btn-sm" href="#">
                                    <i class="bi-gear me-1"></i> Настройки
                                </a>
                            </div>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>
            </div>
            <!-- End Profile Card -->

            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h4 class="card-header-title">
                        <i class="bi-lightning me-2 text-warning"></i>Быстрые действия
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% if user_profile.role == 'participant' %}
                            <div class="col-md-6 mb-3">
                                <!-- Card -->
                                <a class="card card-lg card-transition h-100 text-center" href="/qr/scan/">
                                    <div class="card-body">
                                        <div class="mb-4">
                                            <span class="icon icon-soft-primary icon-circle icon-lg mb-3">
                                                <i class="bi-qr-code-scan icon-inner"></i>
                                            </span>
                                        </div>
                                        <h4 class="card-title">Сканировать QR</h4>
                                        <p class="card-text">Отметьте своё присутствие сканированием QR-кода</p>
                                    </div>
                                </a>
                                <!-- End Card -->
                            </div>
                            <div class="col-md-6 mb-3">
                                <!-- Card -->
                                <a class="card card-lg card-transition h-100 text-center" href="{% url 'groups:my_groups' %}">
                                    <div class="card-body">
                                        <div class="mb-4">
                                            <span class="icon icon-soft-info icon-circle icon-lg mb-3">
                                                <i class="bi-journal-text icon-inner"></i>
                                            </span>
                                        </div>
                                        <h4 class="card-title">Мой журнал</h4>
                                        <p class="card-text">Просмотрите историю посещений и статистику</p>
                                    </div>
                                </a>
                                <!-- End Card -->
                            </div>
                        {% else %}
                            <div class="col-md-4 mb-3">
                                <!-- Card -->
                                <a class="card card-lg card-transition h-100 text-center" href="{% url 'groups:trainer_groups' %}">
                                    <div class="card-body">
                                        <div class="mb-4">
                                            <span class="icon icon-soft-primary icon-circle icon-lg mb-3">
                                                <i class="bi-people-fill icon-inner"></i>
                                            </span>
                                        </div>
                                        <h4 class="card-title">Мои группы</h4>
                                        <p class="card-text">Управляйте группами и отслеживайте посещаемость</p>
                                    </div>
                                </a>
                                <!-- End Card -->
                            </div>
                            <div class="col-md-4 mb-3">
                                <!-- Card -->
                                <a class="card card-lg card-transition h-100 text-center" href="/qr/scan/">
                                    <div class="card-body">
                                        <div class="mb-4">
                                            <span class="icon icon-soft-success icon-circle icon-lg mb-3">
                                                <i class="bi-qr-code-scan icon-inner"></i>
                                            </span>
                                        </div>
                                        <h4 class="card-title">Сканировать QR</h4>
                                        <p class="card-text">Сканируйте QR-коды участников</p>
                                    </div>
                                </a>
                                <!-- End Card -->
                            </div>
                            <div class="col-md-4 mb-3">
                                <!-- Card -->
                                <a class="card card-lg card-transition h-100 text-center" href="#">
                                    <div class="card-body">
                                        <div class="mb-4">
                                            <span class="icon icon-soft-warning icon-circle icon-lg mb-3">
                                                <i class="bi-graph-up icon-inner"></i>
                                            </span>
                                        </div>
                                        <h4 class="card-title">Статистика</h4>
                                        <p class="card-text">Просмотрите аналитику посещаемости</p>
                                        <span class="badge bg-soft-info text-info">Скоро</span>
                                    </div>
                                </a>
                                <!-- End Card -->
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- End Quick Actions -->
        </div>
    {% else %}
        <!-- Landing Page for Non-Authenticated Users -->
        
        <!-- Hero -->
        <div class="overflow-hidden gradient-radial-sm-primary">
            <div class="content-space-t-3 content-space-t-lg-4 content-space-b-2">
                <div class="container">
                    <div class="w-lg-75 text-center mx-lg-auto text-center mx-auto">
                        <!-- Heading -->
                        <div class="mb-7">
                            <h1 class="display-2 text-white mb-3">Система учета <span class="text-warning text-highlight-warning">посещений</span></h1>
                            <p class="fs-2 text-white-70">Современное решение для эффективного учета посещаемости с использованием QR-технологий от ОРЛЕУ</p>
                        </div>
                        <!-- End Heading -->

                        <!-- Buttons -->
                        <div class="d-flex flex-wrap gap-3 justify-content-center mb-7">
                            <a class="btn btn-warning btn-lg" href="/accounts/login/">
                                <i class="bi-box-arrow-in-right me-2"></i>Войти в систему
                            </a>
                            <a class="btn btn-outline-light btn-lg" href="#features">
                                <i class="bi-info-circle me-2"></i>Узнать больше
                            </a>
                        </div>
                        <!-- End Buttons -->
                    </div>

                    <!-- Hero Image -->
                    <div class="text-center">
                        <div class="position-relative">
                            <img class="img-fluid shadow-lg rounded-3" src="{% static 'main/assets/svg/illustrations/oc-collaboration.svg' %}" alt="QR система" style="max-height: 500px;" data-hs-theme-appearance="default">
                            <img class="img-fluid shadow-lg rounded-3" src="{% static 'main/assets/svg/illustrations-light/oc-collaboration.svg' %}" alt="QR система" style="max-height: 500px;" data-hs-theme-appearance="dark">
                        </div>
                    </div>
                    <!-- End Hero Image -->
                </div>
            </div>
        </div>
        <!-- End Hero -->

        <!-- Features Section -->
        <div class="container content-space-2 content-space-lg-3" id="features">
            <!-- Heading -->
            <div class="w-lg-75 text-center mx-lg-auto mb-7 mb-md-10">
                <h2 class="display-4">Возможности <span class="text-primary">системы</span></h2>
                <p class="lead">Все необходимые инструменты для управления посещаемостью в одном месте</p>
            </div>
            <!-- End Heading -->

            <div class="row">
                <div class="col-md-6 col-lg-4 mb-4">
                    <!-- Card -->
                    <div class="card card-lg h-100 text-center">
                        <div class="card-body">
                            <div class="mb-4">
                                <span class="icon icon-soft-primary icon-circle icon-lg">
                                    <i class="bi-qr-code-scan icon-inner"></i>
                                </span>
                            </div>
                            <h4 class="card-title">QR-сканирование</h4>
                            <p class="card-text">Быстрая отметка присутствия через сканирование QR-кодов с мобильных устройств</p>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>

                <div class="col-md-6 col-lg-4 mb-4">
                    <!-- Card -->
                    <div class="card card-lg h-100 text-center">
                        <div class="card-body">
                            <div class="mb-4">
                                <span class="icon icon-soft-success icon-circle icon-lg">
                                    <i class="bi-people-fill icon-inner"></i>
                                </span>
                            </div>
                            <h4 class="card-title">Управление группами</h4>
                            <p class="card-text">Организация и мониторинг учебных групп с детальной аналитикой</p>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>

                <div class="col-md-6 col-lg-4 mb-4">
                    <!-- Card -->
                    <div class="card card-lg h-100 text-center">
                        <div class="card-body">
                            <div class="mb-4">
                                <span class="icon icon-soft-info icon-circle icon-lg">
                                    <i class="bi-graph-up icon-inner"></i>
                                </span>
                            </div>
                            <h4 class="card-title">Аналитика</h4>
                            <p class="card-text">Подробные отчеты и статистика посещаемости в реальном времени</p>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>

                <div class="col-md-6 col-lg-4 mb-4">
                    <!-- Card -->
                    <div class="card card-lg h-100 text-center">
                        <div class="card-body">
                            <div class="mb-4">
                                <span class="icon icon-soft-warning icon-circle icon-lg">
                                    <i class="bi-shield-check icon-inner"></i>
                                </span>
                            </div>
                            <h4 class="card-title">Безопасность</h4>
                            <p class="card-text">Защищенная система авторизации и контроля доступа к данным</p>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>

                <div class="col-md-6 col-lg-4 mb-4">
                    <!-- Card -->
                    <div class="card card-lg h-100 text-center">
                        <div class="card-body">
                            <div class="mb-4">
                                <span class="icon icon-soft-secondary icon-circle icon-lg">
                                    <i class="bi-speedometer2 icon-inner"></i>
                                </span>
                            </div>
                            <h4 class="card-title">Быстродействие</h4>
                            <p class="card-text">Молниеносная обработка данных и мгновенное обновление статуса</p>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>

                <div class="col-md-6 col-lg-4 mb-4">
                    <!-- Card -->
                    <div class="card card-lg h-100 text-center">
                        <div class="card-body">
                            <div class="mb-4">
                                <span class="icon icon-soft-dark icon-circle icon-lg">
                                    <i class="bi-phone icon-inner"></i>
                                </span>
                            </div>
                            <h4 class="card-title">Мобильность</h4>
                            <p class="card-text">Адаптивный дизайн для комфортной работы на любых устройствах</p>
                        </div>
                    </div>
                    <!-- End Card -->
                </div>
            </div>
        </div>
        <!-- End Features Section -->

        <!-- CTA Section -->
        <div class="gradient-radial-sm-primary">
            <div class="container content-space-2">
                <div class="w-lg-75 text-center mx-lg-auto">
                    <div class="mb-5">
                        <h2 class="display-4 text-white mb-3">Начните использовать систему уже сегодня</h2>
                        <p class="fs-2 text-white-70">Присоединяйтесь к современному подходу управления посещаемостью</p>
                    </div>

                    <a class="btn btn-warning btn-lg" href="/accounts/login/">
                        <i class="bi-rocket-takeoff me-2"></i>Войти в систему
                    </a>
                </div>
            </div>
        </div>
        <!-- End CTA Section -->
    {% endif %}
{% endblock %}
