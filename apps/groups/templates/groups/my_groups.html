{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "–ú–æ–∏ –≥—Ä—É–ø–ø—ã" %}{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">{% trans "–í–∞—à–∏ –≥—Ä—É–ø–ø—ã" %}</h2>

    {% if groups %}
        {% for group in groups %}
            {% if user in group.trainers.all %}
                {# üíº –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî —Ç—Ä–µ–Ω–µ—Ä #}
                <div class="card mb-4">
                    <div class="card-header">
                        <strong>{{ group.code }}</strong> ‚Äî {{ group.course_name }}
                    </div>
                    <div class="card-body">
                        <p><strong>{% trans "–¢—Ä–µ–Ω–µ—Ä" %}:</strong> {{ group.supervisor_name }}</p>
                        <p><strong>{% trans "–î–∞—Ç—ã" %}:</strong> {{ group.start_date }} ‚Äî {{ group.end_date }}</p>

                        <p><strong>QR Entry:</strong> {{ group.sessions.first.qr_token_entry }}</p>
                        <p><strong>QR Exit:</strong> {{ group.sessions.first.qr_token_exit }}</p>

                        <hr>
                        <h5>{% trans "–£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥—Ä—É–ø–ø—ã" %}</h5>
                        <ul>
                            {% for person in group.participants.all %}
                                <li>{{ person.full_name }} ({{ person.iin }})</li>
                            {% endfor %}
                        </ul>

                        {% if group.sessions.all %}
                            <hr>
                            <h5>{% trans "–°–µ—Å—Å–∏–∏" %}:</h5>
                            <ul class="list-group">
                                {% for session in group.sessions.all %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        {{ session.date }}
                                        <span>
                                            üïò {{ session.entry_start }} ‚Äî {{ session.entry_end }}
                                            |
                                            üïî {{ session.exit_start }} ‚Äî {{ session.exit_end }}<br>
                                            <small>QR Entry: {{ session.qr_token_entry }}</small><br>
                                            <small>QR Exit: {{ session.qr_token_exit }}</small>
                                        </span>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                </div>
            {% else %}
                {# üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫ #}
                <div class="card mb-4">
                    <div class="card-header">
                        <strong>{{ group.code }}</strong> ‚Äî {{ group.course_name }}
                    </div>
                    <div class="card-body">
                        <p><strong>{% trans "–¢—Ä–µ–Ω–µ—Ä" %}:</strong> {{ group.supervisor_name }}</p>
                        <p><strong>{% trans "–î–∞—Ç—ã" %}:</strong> {{ group.start_date }} ‚Äî {{ group.end_date }}</p>

                        {% if group.sessions.all %}
                            <hr>
                            <h5>{% trans "–°–µ—Å—Å–∏–∏" %}:</h5>
                            <ul class="list-group">
                                {% for session in group.sessions.all %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        {{ session.date }}
                                        <span>
                                            üïò {{ session.entry_start }} ‚Äî {{ session.entry_end }}
                                            |
                                            üïî {{ session.exit_start }} ‚Äî {{ session.exit_end }}
                                        </span>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    {% else %}
        <p class="text-muted">{% trans "–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø." %}</p>
    {% endif %}
</div>
{% endblock %}
